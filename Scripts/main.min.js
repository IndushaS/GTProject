// small screens: header/nav

$(function() {
  var $toggle          = $('.header-toggle'),
      speed            = 'fast',
      $headerDropdown  = $('.header-dropdown'),
      $matchDropdown,
      active           = 'header-active',
      $dataNav;
  
  $toggle.click(function(e) {
    e.preventDefault();
    // prevent anchor tag from going to its URL
    // always give anchor tags a URL in case JS is disabled!
    $dataNav = $('[data-nav="' + $(this).data('nav') + '"]');
    // store the data-nav info of the toggle
    $matchDropdown = $headerDropdown.filter($dataNav);
    // find the dropdown that matches the toggle
    if ($matchDropdown.hasClass(active)) {
      // if the current toggle/dropdown is already active...
      $matchDropdown.slideUp(speed).removeClass(active);
      // turn it off
    } else {
      if ($('.' + active)) {
      // if a different toggle/dropdown is active
        $('.' + active).slideUp(speed).removeClass(active);
        // turn it off
      }
      $matchDropdown.slideDown(speed).addClass(active);
      // turn on matching dropdown
    }
  });
  
});

$(function() {
  var $mainNavSmall   = $('.main-nav-small-link'),
      $subnav         = $('.subnav'),
      active          = 'subnav-active',
      $dataNav,
      speed           = 'fast',
      $matchSubnav;
  
  $mainNavSmall.click(function(e) {
    e.preventDefault();
    // prevent anchor tag from going to its URL
    // always give anchor tags a URL in case JS is disabled!
    $dataNav = $('[data-nav="' + $(this).data('nav') + '"]');
    // store the data-nav info of the toggle
    $matchSubnav = $subnav.filter($dataNav);
    // find the subnav that matches the toggle
    if ($matchSubnav.hasClass(active)) {
      // if the current toggle/subnav is already active...
      $matchSubnav.slideUp(speed);
      $('.' + active).removeClass(active);
      // turn it off
    } else {
      if ($('.' + active)) {
      // if a different toggle/subnav is active
        $('.subnav.' + active).slideUp(speed);
        // hide the active subnav
        $('.' + active).removeClass(active);
        // remove active classes
      }
      $matchSubnav.slideDown(speed).addClass(active);
      // show matching subnav and make it active
      $(this).parent().addClass(active);
      // make the LI parent of the anchor tag active
    }
  });
});

// close-btn in header dropdowns - will need to expand this to work everywhere! 

$(function() {
  var $closeBtn       = $('.close-btn'),
      active          = 'header-active',
      speed           = 'fast';

  $closeBtn.click(function(e) {
    e.preventDefault();
    // disable anchor tag
    $(this).closest($('.' + active)).slideUp(speed).removeClass(active);
    // go up through ancestors to find the active element
  });
});

$(function() {
  var $mega           = $('.megamenu'),
      $megaToggle     = $('.mega-toggle'),
      $megaItem       = $('.mega-item'),
//      $subnav         = $('.mega-subnav'),
      $dataNav,
      active          = 'mega-active',
      $overlay        = $('.overlay'),
      speed           = 'fast';
  
  $megaToggle.click(function(e) {
    if($(this).attr('data-nav')) {
    // check if there is a data-nav attribute (does this have a dropdown?)
      e.preventDefault();
      // if it has a dropdown, disable the anchor tag 
    }
  });
  
  $megaToggle.hover(function() {
    if($(this).attr('data-nav')) {
    // check if there is a data-nav attribute (does this have a dropdown?)
      if($('.' + active)) { 
        $('.' + active).removeClass(active); 
      }
      // if there is something active already, remove its active class
      $dataNav = $(this).data('nav');
      $('[data-nav="' + $dataNav + '"]').addClass(active);
      console.log($mega.find($('.mega-subnav-content')));
      $mega.stop(true, false).animate({
        height: $mega.find($megaItem).filter('.' + active).css('height')
      }, speed);
      $overlay.stop(true, false).fadeIn();
    }
  }, function() {
    if($(this).attr('data-nav')) {
      $dataNav = $(this).data('nav');
      $overlay.stop(true, false).fadeOut();
      $mega.stop(true, false).animate({
        height: 0
      }, speed, function () {
        $('[data-nav="' + $dataNav + '"]').removeClass(active);
      });
    }
  });
});

// @codekit-prepend "_nav-small.js", "_subnav-small.js", "_close-btn.js","_megamenu.js";


